# 시나리오 API 테스트 케이스 상세 명세

## 📋 개요

각 시나리오별로 성공/실패/엣지 케이스를 포함한 촘촘한 테스트 케이스를 정의합니다.

---

## 🔐 시나리오 1: 사용자 등록/로그인 플로우

### 1.1 사용자 등록 시나리오

#### ✅ 성공 케이스

1. **정상적인 사용자 등록**

   - 입력: 유효한 이메일, 강한 비밀번호, 전체 이름, 회사명
   - 예상 결과: 201 Created, 사용자 및 회사 생성, JWT 토큰 반환
   - 검증: 사용자 정보, 회사 정보, 토큰 유효성

2. **첫 번째 사용자 (회사 소유자) 등록**
   - 입력: 새로운 이메일, 새로운 회사명
   - 예상 결과: OWNER 역할로 회사 생성
   - 검증: 사용자 역할이 OWNER인지 확인

#### ❌ 실패 케이스

1. **중복 이메일 등록**

   - 입력: 이미 존재하는 이메일
   - 예상 결과: 409 Conflict
   - 검증: 에러 메시지 확인

2. **유효하지 않은 이메일 형식**

   - 입력: 잘못된 이메일 형식 (예: "invalid-email")
   - 예상 결과: 400 Bad Request
   - 검증: 유효성 검사 에러 메시지

3. **약한 비밀번호**

   - 입력: 8자 미만, 특수문자 없는 비밀번호
   - 예상 결과: 400 Bad Request
   - 검증: 비밀번호 강도 검증 에러

4. **빈 필수 필드**
   - 입력: 이메일, 비밀번호, 이름, 회사명 중 하나 이상 누락
   - 예상 결과: 400 Bad Request
   - 검증: 필수 필드 누락 에러

#### 🔍 엣지 케이스

1. **매우 긴 문자열 입력**

   - 입력: 255자 이상의 이름, 회사명
   - 예상 결과: 400 Bad Request 또는 잘림 처리
   - 검증: 문자열 길이 제한 확인

2. **특수문자가 포함된 이름**
   - 입력: 이모지, 특수문자가 포함된 이름
   - 예상 결과: 성공 또는 검증 에러
   - 검증: 특수문자 처리 방식 확인

### 1.2 사용자 로그인 시나리오

#### ✅ 성공 케이스

1. **정상적인 로그인**

   - 입력: 유효한 이메일과 비밀번호
   - 예상 결과: 200 OK, JWT 토큰 반환
   - 검증: 토큰 유효성, 사용자 정보 일치

2. **토큰 리프레시**
   - 입력: 유효한 refresh token
   - 예상 결과: 200 OK, 새로운 access token 반환
   - 검증: 새 토큰 유효성, refresh token 갱신

#### ❌ 실패 케이스

1. **잘못된 비밀번호**

   - 입력: 올바른 이메일, 잘못된 비밀번호
   - 예상 결과: 401 Unauthorized
   - 검증: 인증 실패 메시지

2. **존재하지 않는 이메일**

   - 입력: 등록되지 않은 이메일
   - 예상 결과: 401 Unauthorized
   - 검증: 사용자 없음 메시지

3. **만료된 토큰으로 리프레시**
   - 입력: 만료된 refresh token
   - 예상 결과: 401 Unauthorized
   - 검증: 토큰 만료 메시지

#### 🔍 엣지 케이스

1. **대소문자 구분**

   - 입력: 이메일 대소문자 변경
   - 예상 결과: 성공 (이메일은 대소문자 무시)
   - 검증: 이메일 정규화 확인

2. **연속 로그인 시도**
   - 입력: 짧은 시간 내 반복 로그인 시도
   - 예상 결과: 성공 또는 rate limiting
   - 검증: rate limiting 적용 여부

---

## 🏢 시나리오 2: 회사 생성/멤버 초대 플로우

### 2.1 회사 정보 관리

#### ✅ 성공 케이스

1. **회사 정보 조회**

   - 입력: 유효한 JWT 토큰
   - 예상 결과: 200 OK, 회사 정보 반환
   - 검증: 회사명, 플랜, 설정 정보

2. **회사 설정 업데이트**
   - 입력: 회사명, 도메인, 설정 변경
   - 예상 결과: 200 OK, 업데이트된 정보 반환
   - 검증: 변경사항 반영 확인

#### ❌ 실패 케이스

1. **권한 없는 사용자의 회사 정보 조회**

   - 입력: 다른 회사 사용자의 토큰
   - 예상 결과: 403 Forbidden
   - 검증: 권한 부족 메시지

2. **존재하지 않는 회사 정보 조회**
   - 입력: 삭제된 회사 사용자의 토큰
   - 예상 결과: 404 Not Found
   - 검증: 회사 없음 메시지

### 2.2 멤버 관리

#### ✅ 성공 케이스

1. **회사 멤버 목록 조회**

   - 입력: OWNER/ADMIN 토큰
   - 예상 결과: 200 OK, 멤버 목록 반환
   - 검증: 멤버 수, 역할 정보

2. **새 멤버 초대**

   - 입력: 유효한 이메일, 역할 지정
   - 예상 결과: 201 Created, 초대 생성
   - 검증: 초대 상태, 만료 시간

3. **멤버 역할 변경**

   - 입력: MEMBER → ADMIN 역할 변경
   - 예상 결과: 200 OK, 역할 변경
   - 검증: 새로운 역할 적용

4. **멤버 제거**
   - 입력: MEMBER 사용자 제거
   - 예상 결과: 200 OK, 멤버 제거
   - 검증: 멤버 목록에서 제거 확인

#### ❌ 실패 케이스

1. **MEMBER가 멤버 관리 시도**

   - 입력: MEMBER 토큰으로 멤버 초대
   - 예상 결과: 403 Forbidden
   - 검증: 권한 부족 메시지

2. **소유자 제거 시도**

   - 입력: OWNER 사용자 제거 시도
   - 예상 결과: 400 Bad Request
   - 검증: 소유자 제거 불가 메시지

3. **중복 이메일 초대**
   - 입력: 이미 초대된 이메일
   - 예상 결과: 409 Conflict
   - 검증: 중복 초대 에러

#### 🔍 엣지 케이스

1. **마지막 소유자 역할 변경**

   - 입력: 유일한 OWNER를 MEMBER로 변경
   - 예상 결과: 400 Bad Request
   - 검증: 최소 소유자 유지 규칙

2. **동시 멤버 초대**
   - 입력: 동일한 이메일에 동시 초대
   - 예상 결과: 첫 번째만 성공, 나머지는 409 Conflict
   - 검증: 동시성 처리 확인

---

## 💬 시나리오 3: 채팅방 생성/메시지 전송 플로우

### 3.1 채팅방 관리

#### ✅ 성공 케이스

1. **채팅방 생성**

   - 입력: 채팅방명, 설명, 멤버 목록
   - 예상 결과: 201 Created, 채팅방 생성
   - 검증: 채팅방 정보, 멤버 추가

2. **채팅방 목록 조회**

   - 입력: 사용자 토큰
   - 예상 결과: 200 OK, 참여 채팅방 목록
   - 검증: 채팅방 수, 최근 활동

3. **채팅방 정보 조회**
   - 입력: 채팅방 ID
   - 예상 결과: 200 OK, 상세 정보 반환
   - 검증: 멤버 목록, 설정 정보

#### ❌ 실패 케이스

1. **권한 없는 채팅방 접근**

   - 입력: 참여하지 않은 채팅방 ID
   - 예상 결과: 403 Forbidden
   - 검증: 접근 권한 부족 메시지

2. **중복 채팅방명**
   - 입력: 동일한 회사 내 중복 채팅방명
   - 예상 결과: 409 Conflict
   - 검증: 중복 이름 에러

### 3.2 메시지 전송

#### ✅ 성공 케이스

1. **텍스트 메시지 전송**

   - 입력: 메시지 내용, 채팅방 ID
   - 예상 결과: 201 Created, 메시지 생성
   - 검증: 메시지 내용, 전송 시간, 발신자

2. **파일 첨부 메시지**

   - 입력: 파일 ID, 메시지 내용
   - 예상 결과: 201 Created, 파일 메시지 생성
   - 검증: 파일 정보, 다운로드 링크

3. **스레드 참조 메시지**
   - 입력: #스레드명이 포함된 메시지
   - 예상 결과: 201 Created, 스레드 링크 생성
   - 검증: 스레드 참조 정보

#### ❌ 실패 케이스

1. **빈 메시지 전송**

   - 입력: 빈 내용 또는 공백만
   - 예상 결과: 400 Bad Request
   - 검증: 빈 메시지 에러

2. **매우 긴 메시지**

   - 입력: 10,000자 이상의 메시지
   - 예상 결과: 400 Bad Request
   - 검증: 메시지 길이 제한

3. **존재하지 않는 파일 참조**
   - 입력: 삭제된 파일 ID
   - 예상 결과: 400 Bad Request
   - 검증: 파일 없음 에러

#### 🔍 엣지 케이스

1. **동시 메시지 전송**

   - 입력: 동일 채팅방에 동시 메시지
   - 예상 결과: 모든 메시지 성공
   - 검증: 순서 유지, 중복 없음

2. **특수문자 포함 메시지**
   - 입력: 이모지, HTML 태그 포함
   - 예상 결과: 성공 또는 이스케이프 처리
   - 검증: 특수문자 처리 방식

---

## 📁 시나리오 4: 스레드 생성/파일 공유 플로우

### 4.1 스레드 관리

#### ✅ 성공 케이스

1. **스레드 생성**

   - 입력: 스레드 제목, 설명, 채팅방 ID
   - 예상 결과: 201 Created, 스레드 생성
   - 검증: 스레드 정보, 생성자

2. **스레드 목록 조회**

   - 입력: 채팅방 ID 또는 전체 목록
   - 예상 결과: 200 OK, 스레드 목록
   - 검증: 페이지네이션, 정렬

3. **스레드 상세 조회**
   - 입력: 스레드 ID
   - 예상 결과: 200 OK, 스레드 상세 정보
   - 검증: 메시지 목록, 참여자

#### ❌ 실패 케이스

1. **권한 없는 스레드 접근**

   - 입력: 참여하지 않은 채팅방의 스레드
   - 예상 결과: 403 Forbidden
   - 검증: 접근 권한 부족

2. **중복 스레드 제목**
   - 입력: 동일 채팅방 내 중복 제목
   - 예상 결과: 409 Conflict
   - 검증: 중복 제목 에러

### 4.2 파일 공유

#### ✅ 성공 케이스

1. **파일 업로드 세션 시작**

   - 입력: 파일명, 크기, MIME 타입
   - 예상 결과: 201 Created, 업로드 세션
   - 검증: 세션 ID, 청크 정보

2. **파일 청크 업로드**

   - 입력: 세션 ID, 청크 데이터
   - 예상 결과: 200 OK, 업로드 진행률
   - 검증: 진행률, 완료 여부

3. **파일 다운로드**
   - 입력: 파일 ID
   - 예상 결과: 200 OK, 파일 스트림
   - 검증: 파일 내용, MIME 타입

#### ❌ 실패 케이스

1. **할당량 초과 업로드**

   - 입력: 회사 스토리지 한도 초과 파일
   - 예상 결과: 413 Payload Too Large
   - 검증: 할당량 초과 에러

2. **지원하지 않는 파일 형식**

   - 입력: 위험한 파일 확장자
   - 예상 결과: 400 Bad Request
   - 검증: 파일 형식 제한

3. **만료된 다운로드 링크**
   - 입력: 만료된 파일 ID
   - 예상 결과: 410 Gone
   - 검증: 링크 만료 메시지

#### 🔍 엣지 케이스

1. **대용량 파일 업로드**

   - 입력: 1GB 이상의 파일
   - 예상 결과: 성공 또는 타임아웃
   - 검증: 대용량 파일 처리

2. **동시 파일 업로드**
   - 입력: 동일 파일에 대한 동시 업로드
   - 예상 결과: 첫 번째만 성공
   - 검증: 동시성 처리

---

## 🔄 시나리오 5: 파일 업로드 + 스레드 자동 생성 플로우

### 5.1 자동 스레드 생성

#### ✅ 성공 케이스

1. **파일 업로드 시 자동 스레드 생성**

   - 입력: createThread=true, 스레드 제목/설명
   - 예상 결과: 파일 업로드 + 스레드 자동 생성
   - 검증: 스레드 정보, 파일 연결

2. **기존 스레드에 파일 추가**
   - 입력: 기존 스레드 ID 지정
   - 예상 결과: 파일이 지정된 스레드에 추가
   - 검증: 스레드-파일 연결

#### ❌ 실패 케이스

1. **자동 스레드 생성 실패**

   - 입력: 유효하지 않은 스레드 정보
   - 예상 결과: 파일 업로드 실패
   - 검증: 전체 트랜잭션 롤백

2. **존재하지 않는 스레드에 파일 추가**
   - 입력: 삭제된 스레드 ID
   - 예상 결과: 404 Not Found
   - 검증: 스레드 없음 에러

#### 🔍 엣지 케이스

1. **동시 자동 스레드 생성**
   - 입력: 동일한 이름으로 동시 스레드 생성
   - 예상 결과: 첫 번째만 성공
   - 검증: 동시성 처리

---

## 👥 시나리오 6: 사용자 역할 관리/권한 플로우

### 6.1 역할 변경

#### ✅ 성공 케이스

1. **MEMBER → ADMIN 역할 변경**

   - 입력: OWNER가 MEMBER를 ADMIN으로 변경
   - 예상 결과: 200 OK, 역할 변경
   - 검증: 새로운 권한 적용

2. **ADMIN → MEMBER 역할 변경**
   - 입력: OWNER가 ADMIN을 MEMBER로 변경
   - 예상 결과: 200 OK, 역할 변경
   - 검증: 권한 제한 확인

#### ❌ 실패 케이스

1. **MEMBER가 역할 변경 시도**

   - 입력: MEMBER가 다른 사용자 역할 변경
   - 예상 결과: 403 Forbidden
   - 검증: 권한 부족 에러

2. **마지막 OWNER 역할 변경**
   - 입력: 유일한 OWNER를 다른 역할로 변경
   - 예상 결과: 400 Bad Request
   - 검증: 최소 소유자 유지 규칙

#### 🔍 엣지 케이스

1. **자기 자신의 역할 변경**
   - 입력: OWNER가 자신을 MEMBER로 변경
   - 예상 결과: 400 Bad Request
   - 검증: 자기 자신 역할 변경 제한

---

## 💾 시나리오 7: 스토리지 할당량 관리 플로우

### 7.1 할당량 조회

#### ✅ 성공 케이스

1. **할당량 정보 조회**
   - 입력: 회사 사용자 토큰
   - 예상 결과: 200 OK, 사용량/한도 정보
   - 검증: 사용량, 한도, 퍼센트

#### ❌ 실패 케이스

1. **할당량 정보 조회 실패**
   - 입력: 유효하지 않은 토큰
   - 예상 결과: 401 Unauthorized
   - 검증: 인증 실패

### 7.2 할당량 관리

#### ✅ 성공 케이스

1. **파일 삭제로 할당량 확보**
   - 입력: 파일 삭제 요청
   - 예상 결과: 200 OK, 할당량 감소
   - 검증: 할당량 업데이트

#### ❌ 실패 케이스

1. **할당량 초과 업로드**
   - 입력: 할당량 초과 파일 업로드
   - 예상 결과: 413 Payload Too Large
   - 검증: 할당량 초과 에러

#### 🔍 엣지 케이스

1. **할당량 임계점 근처**
   - 입력: 95% 이상 사용 중인 상태
   - 예상 결과: 경고 메시지 또는 제한
   - 검증: 임계점 처리

---

## 👥 시나리오 8: 다중 사용자 협업 시나리오

### 8.1 동시 작업

#### ✅ 성공 케이스

1. **동시 메시지 전송**

   - 입력: 여러 사용자가 동시에 메시지 전송
   - 예상 결과: 모든 메시지 성공
   - 검증: 순서 유지, 중복 없음

2. **동시 파일 업로드**
   - 입력: 여러 사용자가 동시에 파일 업로드
   - 예상 결과: 모든 업로드 성공
   - 검증: 각각의 진행률 추적

#### ❌ 실패 케이스

1. **동시 스레드 생성 충돌**
   - 입력: 동일한 이름으로 동시 스레드 생성
   - 예상 결과: 첫 번째만 성공
   - 검증: 동시성 처리

#### 🔍 엣지 케이스

1. **대량 동시 요청**
   - 입력: 100개 이상의 동시 요청
   - 예상 결과: 성공 또는 rate limiting
   - 검증: 부하 처리 능력

---

## 🔄 시나리오 9: 에러 복구/재시도 시나리오

### 9.1 네트워크 에러

#### ✅ 성공 케이스

1. **일시적 네트워크 에러 복구**
   - 입력: 네트워크 끊김 후 재연결
   - 예상 결과: 자동 재시도 성공
   - 검증: 상태 복구

#### ❌ 실패 케이스

1. **지속적인 네트워크 에러**
   - 입력: 계속되는 네트워크 문제
   - 예상 결과: 최종 실패
   - 검증: 재시도 한도

### 9.2 서버 에러

#### ✅ 성공 케이스

1. **일시적 서버 에러 복구**
   - 입력: 500 에러 후 재시도
   - 예상 결과: 재시도 성공
   - 검증: 에러 복구

#### ❌ 실패 케이스

1. **지속적인 서버 에러**
   - 입력: 계속되는 서버 문제
   - 예상 결과: 최종 실패
   - 검증: 에러 처리

---

## ⚡ 시나리오 10: 부하 상황에서의 성능 시나리오

### 10.1 동시 사용자

#### ✅ 성공 케이스

1. **100명 동시 로그인**

   - 입력: 100명의 동시 로그인 요청
   - 예상 결과: 모든 로그인 성공
   - 검증: 응답 시간, 처리율

2. **1000개 동시 메시지**
   - 입력: 1000개의 동시 메시지 전송
   - 예상 결과: 모든 메시지 성공
   - 검증: 처리 시간, 순서 유지

#### ❌ 실패 케이스

1. **시스템 한도 초과**
   - 입력: 시스템 처리 한도 초과 요청
   - 예상 결과: 일부 실패, rate limiting
   - 검증: 한도 관리

#### 🔍 엣지 케이스

1. **메모리 부족 상황**
   - 입력: 대용량 파일 동시 처리
   - 예상 결과: 성공 또는 메모리 부족 에러
   - 검증: 리소스 관리

---

## 📊 테스트 실행 순서

### Phase 1: 기본 기능 테스트

1. 사용자 등록/로그인 플로우
2. 회사 생성/멤버 초대 플로우

### Phase 2: 핵심 기능 테스트

3. 채팅방 생성/메시지 전송 플로우
4. 스레드 생성/파일 공유 플로우
5. 파일 업로드 + 스레드 자동 생성 플로우

### Phase 3: 관리 기능 테스트

6. 사용자 역할 관리/권한 플로우
7. 스토리지 할당량 관리 플로우

### Phase 4: 고급 시나리오 테스트

8. 다중 사용자 협업 시나리오
9. 에러 복구/재시도 시나리오
10. 부하 상황에서의 성능 시나리오

---

## 🎯 검증 포인트

각 시나리오에서 다음을 검증합니다:

1. **기능적 검증**: API가 예상대로 동작하는지
2. **데이터 검증**: 응답 데이터가 올바른지
3. **권한 검증**: 권한이 올바르게 적용되는지
4. **에러 처리**: 에러가 적절히 처리되는지
5. **성능 검증**: 응답 시간이 허용 범위 내인지
6. **동시성 검증**: 동시 요청이 올바르게 처리되는지
7. **데이터 일관성**: 데이터가 일관성 있게 유지되는지
